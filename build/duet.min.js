var BindableProperty=function(){function a(a,b,c,d,e){if(this.dirty=!1,this.name=a,this._internalExpression=b,this._tempValue=null,this._parentValue=d,this._externalReference=null,this.propertyChange=new CustomEvent(this.propertyChangeEvent,{detail:this}),Array.isArray(c)||c instanceof ObservableArray){if(Array.isArray(c)){var f=null;f=e?new ObservableArray(a,this):new ObservableArray(a),f.initialize(c),this.value=f}else this.value=c;this.dirty=!0}else this.value=c}return Object.defineProperty(a.prototype,"internalExpression",{get:function(){return this._internalExpression},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dispatchEvents",{get:function(){return window["dt-dispatchEvents"]||(window["dt-dispatchEvents"]=[]),window["dt-dispatchEvents"]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"value",{get:function(){if(this._parseInProgress)return null;this.name;if(0!=this._internalExpression.indexOf("#")&&0!=this._internalExpression.indexOf("@")||1!=this.dirty)return this._value;var a=this._internalExpression.slice(1),b=null;if(-1!=a.indexOf("=>")&&(a=DynamicCode.parseLambdaExpression(a)),0==this._internalExpression.indexOf("@")){this._eventExpresion=a;var c=this;b=function(){return window["dt-dispatchEvents"]=[],DynamicCode.evalInContext(c._eventExpresion,c._parentValue)}}else b=DynamicCode.evalInContext(a,this._parentValue);return this._value=b,this.dirty=!1,b},set:function(a){this._value=a,document.dispatchEvent(this.propertyChange)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"objectValue",{get:function(){if(this.value&&"string"==typeof this.value&&0==this.value.indexOf("#JSON#")){var b=JSON.parse(this.value.slice(6));if(b.hasOwnProperty("mutated-accesors")){var c=b["mutated-accesors"];b["mutated-accesors"]=[];for(var d in c){var e=c[d],f=b["_"+e];ModelProperty.createAccesorProperty(e,b,new a(e,f._internalExpression,f._value,b))}}return b}return this.value},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"internalValue",{set:function(a){this._value=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"propertyChangeEvent",{get:function(){return"propertyChange"+this.name},enumerable:!0,configurable:!0}),a.prototype.dispatchChangeEvent=function(a){if(-1===this.dispatchEvents.indexOf(this.propertyChangeEvent)){a&&(this._externalReference=a),this.dirty=!0;this.dispatchEvents.push(this.propertyChangeEvent);document.dispatchEvent(this.propertyChange)}},a}(),DynamicCode=function(){function DynamicCode(){}return DynamicCode.evalInContext=function(js,context){return function(){return eval(js)}.call(context)},DynamicCode.parseLambdaExpression=function(a){for(var b=a,c=a.indexOf("=>",c);-1!=c;){for(var d=DynamicCode.getLamdbaStart(a,c),e=a.length-1,f=0,g="",h=c;h<a.length-1;h++){if(")"===a[h]){if(0==f){e=h;break}f--}"("===a[h]&&f++}g=DynamicCode.createLambdaFunction(a.slice(d,e+1)),b=b.slice(0,d+1)+g+b.slice(e),c=b.indexOf("=>")}return b},DynamicCode.createLambdaFunction=function(a){var b="",c=a.indexOf("=>"),d=DynamicCode.getLamdbaStart(a,c),e=a.length-1,f=a.slice(d+1,c),g=a.slice(c+2,e);return-1!=g.indexOf("=>")&&(g=DynamicCode.parseLambdaExpression(g)),b="(function("+f+") { return (",b+=g+");})"},DynamicCode.getLamdbaStart=function(a,b){for(var c=b,d=b;d>-1;d--)if("("===a[d]){c=d;break}return c},DynamicCode}(),ModelProperty=function(){function a(b,c){var d=this;this.modelView=b,this.component=c,this.componentBindings={},this.pendingSync={},this.internalBindings={};var e=!1;for(var f in this.component.dataset){if(this.component.dataset.hasOwnProperty(f)&&0==f.indexOf("dt")&&f.length>2){var g=f[2].toLowerCase()+f.slice(3),h=this.component.dataset[f];g=g.replace("html","HTML"),-1===h.indexOf("#")&&(h=h.replace(".","|")),this.componentBindings[g]=this.modelView.modelName+"|"+h,e=!0}if(void 0!=this.component[g]&&this.component[g].length>0&&this.component[g][0]instanceof HTMLElement){var i=this.component[g][0];this._template=i,this.component.removeChild(i)}}if(e){this.createPropertyBinding();for(var j in this.componentBindings){var k=this.componentBindings[j],l=this.bindings[k];this.listenChangeEvents(k,l)}this.component.addEventListener("componentSync",function(b){if(b instanceof CustomEvent&&b.detail instanceof a){var c=b.detail;c.component;for(var e in c.pendingSync){var f=d.bindings[d.componentBindings[e]],g=d.component;if(-1!=e.indexOf(".")){var h=e.split(".");e=h[h.length-1],h=h.slice(0,h.length-1),h.forEach(function(a){g[a]||(g[a]={}),g=g[a]})}void 0!=f&&void 0!=g[e]&&f.value!=g[e]&&(f.value=g[e])}}},!1)}this.componentSync=new CustomEvent("componentSync",{detail:this})}return Object.defineProperty(a.prototype,"dispatchEvents",{get:function(){return window["dt-dispatchEvents"]||(window["dt-dispatchEvents"]=[]),window["dt-dispatchEvents"]},set:function(a){window["dt-dispatchEvents"]=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bindings",{get:function(){return this._modelView.bindings},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"modelView",{get:function(){return this._modelView},set:function(a){this._modelView=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"component",{get:function(){return this._component},set:function(b){var c=this,d=this;this._component=b;var e=new MutationObserver(function(a){a.forEach(function(a){return c.syncComponentChange(a.target,a.attributeName)}),c.syncDependencies(d)}),f={attributes:!0,childList:!1,characterData:!0};e.observe(this._component,f),this._component.onchange=function(){a.syncComponentEvent(d)},this._component.onkeydown=function(){a.syncComponentEvent(d)},this._component.onkeyup=function(){a.syncComponentEvent(d)}},enumerable:!0,configurable:!0}),a.prototype.listenChangeEvents=function(a,b){var c=this;document.addEventListener(b.propertyChangeEvent,function(a){return c.onBindingChange(a)},!1),this.bindings[a].objectValue instanceof ObservableArray&&(document.addEventListener(a+"elementAdded",function(a){if(a.detail instanceof ObservableItem){var b=c.getComponentBinding(a.detail.name);c.bindingObservableItem(a.detail.name,a.detail.index,a.detail.item,b)}}),document.addEventListener(a+"elementRemoved",function(a){if(a.detail instanceof ObservableItem){var b=c.getComponentBinding(a.detail.name);null!=b&&(c.component[b][a.detail.index].remove?c.component[b][a.detail.index].remove():c.component.removeChild(c.component.children[a.detail.index]))}}))},a.prototype.syncDependencies=function(a){this.modelView.isInitialization||a.component.dispatchEvent(a.componentSync),a.pendingSync={}},a.prototype.onBindingChange=function(a){a.preventDefault(),this.setComponentBinding(a.detail),this.modelView.isInitialization||this.modelView.checkBindDependencies(a)},a.prototype.bindingObservableItem=function(a,b,c,d){if(this.bindings[a]&&void 0!=this._template){var e=this.modelView.modelName+"|"+a+"|"+b;if(this.modelView.subModels.some(function(a){return a.modelName===e})){var f=null,g=-1;this.modelView.subModels.forEach(function(a){g++,a.modelName==e&&(f=g)}),f>-1&&(this.modelView.subModels[f].bindings={},this.modelView.subModels.splice(f,1))}var h=this._template.cloneNode(!0);this.component.appendChild(h);var i=new ModelView(e,c,h,d);this.modelView.subModels.push(i)}},a.prototype.getComponentBinding=function(a){var b="";for(var c in this.componentBindings)if(a==this.componentBindings[c]){b=c;break}return b},a.prototype.syncComponentChange=function(a,b){if(a instanceof HTMLElement)for(var c in this.componentBindings){var d=c;if(-1!=c.indexOf(".")&&(d=d.split(".")[0]),d===b){var e=a;if(-1!=c.indexOf(".")){var f=c.split(".");d=f[f.length-1],f=f.slice(0,f.length-1),f.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}this.pendingSync[c]=e[d];break}}},a.prototype.createPropertyBinding=function(){for(var b in this.componentBindings){var c=this.componentBindings[b],d=null;if(this.bindings&&this.bindings[c])d=this.bindings[c],this.internalBindings[c]=d;else{var e=this.modelView.model,f="",g=c;if(-1!==g.indexOf("|")&&(g=g.replace(this.modelView.modelName+"|",""),-1===g.indexOf("#")&&(g=g.replace("|","."))),0!=g.indexOf("#")&&0!=g.indexOf("@")&&-1!=g.indexOf(".")){var h=g.split(".");f=h[h.length-2],g=h[h.length-1],h=h.slice(0,h.length-1),h.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}d=new BindableProperty(c,g,e[g],e),a.createAccesorProperty(g,e,d),this.bindings||(this.bindings={}),this.internalBindings[c]=d,this.bindings[c]=d}}},a.prototype.setComponentBinding=function(a){a.dirty=!0;var b=this.component,c=this.getComponentBinding(a.name);if(null!=c&&-1!=c.indexOf(".")){var d=c.split(".");c=d[d.length-1],d=d.slice(0,d.length-1),d.forEach(function(a){b[a]||(b[a]={}),b=b[a]})}if(void 0!=typeof b[c])if(null!=b[c]&&b[c].__proto__==HTMLCollection.prototype){if(a.dirty){for(var e=b[c].length-1;e>-1;e--)b[c][e].remove?b[c][e].remove():this.component.removeChild(this.component.children[e]);if(Array.isArray(a.objectValue)||a.objectValue instanceof ObservableArray)for(var f=0;f<a.objectValue.length;f++)this.bindingObservableItem(a.name,f,a.objectValue[f],c);else this.bindingObservableItem(a.name,0,a.objectValue,c)}}else"undefined"!=typeof a.value&&(b[c]=a.value)},a.createAccesorProperty=function(a,b,c){if(!b["mutated-accesors"]||-1==b["mutated-accesors"].indexOf(a)){var d="_"+a;b[d]=c,Object.defineProperty(b,a,{get:function(){return this[d].value},set:function(a){this[d].value=a},enumerable:!0,configurable:!0}),b["mutated-accesors"]||(b["mutated-accesors"]=[]),b["mutated-accesors"].push(a)}},a.syncComponentEvent=function(a){a.dispatchEvents=[];for(var b in a.componentBindings)void 0!=typeof a.component[b]&&a.component[b].__proto__!==HTMLCollection.prototype&&(a.pendingSync[b]=a.component[b]);a.syncDependencies(a)},a}();!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=Event.prototype,window.CustomEvent=a}();var ModelView=function(){function a(a,b,c,d){var e=this;if(this.modelName=a,this.properties=new Array,this.bindings||(this.bindings={}),this.subModels=new Array,this.isInitialization=!0,b)if(this.model=b,b["mutated-observation"]){var f=b["mutated-accesors"];for(var g in f){var h=this.modelName+"|"+f[g],i=b["_"+f[g]];i.name=this.modelName+"|"+f[g],this.bindings[h]=i}}else this.createObservableObject(this.model,this.modelName);if(a){var j=null;if(c){j=c.querySelectorAll("[data-dt='"+d+"']");var k=new ModelProperty(this,c);this.properties.push(k)}else j=document.querySelectorAll("[data-dt='"+a+"']");if(j.length>0){var l=Array.prototype.slice.call(j,0);l.forEach(function(a,b){if(a instanceof HTMLElement){var c=new ModelProperty(e,a);e.properties.push(c)}})}this.properties.forEach(function(a){for(var b in a.internalBindings)a.setComponentBinding(a.bindings[b])})}this.isInitialization=!1}return Object.defineProperty(a.prototype,"dispatchEvents",{get:function(){return window["dt-dispatchEvents"]||(window["dt-dispatchEvents"]=[]),window["dt-dispatchEvents"]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bindings",{get:function(){return window[this.modelName+"_dt-bindings"]},set:function(a){window[this.modelName+"_dt-bindings"]=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"modelName",{get:function(){return this._modelName},set:function(a){this._modelName=a},enumerable:!0,configurable:!0}),a.prototype.createObservableObject=function(a,b){var c=this;if(!("object"!=typeof a||a&&a["mutated-observation"])){var d="";b&&(d=b);var e=[];for(var f in a)e.push(f);for(var f in e){var g=e[f];if(0!=g.indexOf("_")&&"function"!=typeof a[g]&&"mutated-accesors"!==g&&0!=g.indexOf("$")){var h=d+"|"+g,i=this.bindings[h];"undefined"==typeof i&&(i=new BindableProperty(h,g,a[g],a,!0)),ModelProperty.createAccesorProperty(g,a,i),this.createObservableObject(a[g],h),this.bindings[h]=i,document.addEventListener(i.propertyChangeEvent,function(b){c.isInitialization||(c.checkBindDependencies(b),a._parentReference&&a._parentReference._binding&&(c.dispatchEvents.push(b.detail.propertyChangeEvent),a._parentReference._binding.dispatchChangeEvent(b.detail.internalExpression)))},!1)}}null!=a&&(a["mutated-observation"]=!0)}},a.prototype.checkBindDependencies=function(a){var b=a.detail.name;if(a.detail._externalReference&&null!=a.detail._externalReference&&(b=a.detail._externalReference),-1!==b.indexOf("|")&&(b=b.replace(this.modelName+"|","").replace("|",".")),0!=b.indexOf("#"))for(var c in this.bindings){var d=this.bindings[c];0==d.internalExpression.indexOf("#")&&d.internalExpression!==b&&this.containsBindReference(d.internalExpression,b)&&d.dispatchChangeEvent()}},a.isAlphanumeric=function(a,b){var c=a.charCodeAt(b);return c>47&&58>c||c>64&&91>c||c>96&&123>c?!0:!1},a.prototype.containsBindReference=function(b,c){for(var d=!1,e=b.indexOf(c);-1!=e;)"."===b[e-1]&&b.length>=e+c.length&&!a.isAlphanumeric(b,e+c.length)?(d=!0,e=-1):e=b.indexOf(c,e+1);return d},a}(),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},ObservableArray=function(a){function b(b,c){a.call(this),this._name=b,c?this._binding=c:this._binding=null}return __extends(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"propertyChangeEvent",{get:function(){return"propertyChange"+this.name},enumerable:!0,configurable:!0}),b.prototype.initialize=function(b){var c=this;b.forEach(function(b){return a.prototype.push.call(c,b)})},b.prototype.push=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];var e=0;return c.forEach(function(c){c._parentReference=b,e=a.prototype.push.call(b,c),null===b._binding?(b.elementAdded=new CustomEvent(b.name+"elementAdded",{detail:new ObservableItem(b.name,c,e)}),document.dispatchEvent(b.elementAdded)):b._binding.dispatchChangeEvent(null)}),e},b.prototype.pop=function(){var b=this.length-1,c=a.prototype.pop.call(this);return null===this._binding?(this.elementRemoved=new CustomEvent(this.name+"elementRemoved",{detail:new ObservableItem(this.name,c,b)}),document.dispatchEvent(this.elementRemoved)):this._binding.dispatchChangeEvent(null),c},b.prototype.unshift=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];var e=0;return c.forEach(function(c){c._parentReference=b,e=a.prototype.unshift.call(b,c),b._binding?(b.elementAdded=new CustomEvent(b.name+"elementAdded",{detail:new ObservableItem(b.name,c,e)}),document.dispatchEvent(b.elementAdded)):b._binding.dispatchChangeEvent(null)}),e},b.prototype.shift=function(){var b=a.prototype.shift.call(this);return null===this._binding?(this.elementRemoved=new CustomEvent(this.name+"elementRemoved",{detail:new ObservableItem(this.name,b,0)}),document.dispatchEvent(this.elementRemoved)):this._binding.dispatchChangeEvent(null),b},b.prototype.change=function(a,b){var c=this[a];for(var d in c)b[d]&&(c[d]=b[d])},b}(Array),ObservableItem=function(){function a(a,b,c){this.name=a,this.item=b,this.index=c}return a}();
//# sourceMappingURL=../sourceMap.map
var ObservableItem=function(){function a(a,b,c){this.name=a,this.item=b,this.index=c}return a}(),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},ObservableArray=function(a){function b(b,c){a.call(this),this._name=b,c?this._binding=c:this._binding=null}return __extends(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"propertyChangeEvent",{get:function(){return"propertyChange"+this.name},enumerable:!0,configurable:!0}),b.prototype.initialize=function(b){var c=this;b.forEach(function(b){return a.prototype.push.call(c,b)})},b.prototype.push=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];var e=0;return c.forEach(function(c){c._parentReference=b,e=a.prototype.push.call(b,c),null===b._binding?(b.elementAdded=new CustomEvent(b.name+"elementAdded",{detail:new ObservableItem(b.name,c,e)}),document.dispatchEvent(b.elementAdded)):b._binding.dispatchChangeEvent(null)}),e},b.prototype.pop=function(){var b=this.length-1,c=a.prototype.pop.call(this);return null===this._binding?(this.elementRemoved=new CustomEvent(this.name+"elementRemoved",{detail:new ObservableItem(this.name,c,b)}),document.dispatchEvent(this.elementRemoved)):this._binding.dispatchChangeEvent(null),c},b.prototype.unshift=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];var e=0;return c.forEach(function(c){c._parentReference=b,e=a.prototype.unshift.call(b,c),null===b._binding?(b.elementAdded=new CustomEvent(b.name+"elementAdded",{detail:new ObservableItem(b.name,c,e)}),document.dispatchEvent(b.elementAdded)):b._binding.dispatchChangeEvent(null)}),e},b.prototype.shift=function(){var b=a.prototype.shift.call(this);return null===this._binding?(this.elementRemoved=new CustomEvent(this.name+"elementRemoved",{detail:new ObservableItem(this.name,b,0)}),document.dispatchEvent(this.elementRemoved)):this._binding.dispatchChangeEvent(null),b},b.prototype.splice=function(a,b){for(var c=this,d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];var f=null;return f=d&&d.length>0?Array.prototype.splice.call(this,a,b,d):Array.prototype.splice.call(this,a,b),f.forEach(function(a){null===c._binding?(c.elementRemoved=new CustomEvent(c.name+"elementRemoved",{detail:new ObservableItem(c.name,a,0)}),document.dispatchEvent(c.elementRemoved)):c._binding.dispatchChangeEvent(null)}),f},b.prototype.change=function(a,b){if("object"==typeof b){var c=this[a];for(var d in c)b[d]&&(c[d]=b[d])}else this[a]=b,this._binding.dispatchChangeEvent(null)},b}(Array);!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=Event.prototype,window.CustomEvent=a}();var ModelView=function(){function a(a,b,c,d,e,f){var g=this;if(this.modelName=a,this.properties=new Array,this.bindings||(this.bindings={}),this.subModels=new Array,this.isInitialization=!0,this.rosettaComps=[],e?this.originalModel=e:this.originalModel=this,f&&(this.parentModel=f),b)if(this.model=b,b["mutated-observation"]){var h=b["mutated-accesors"];for(var i in h){var j=this.modelName+"|"+h[i],k=b["_"+h[i]];k.name=this.modelName+"|"+h[i],this.bindings[j]=k}}else this.createObservableObject(this.model,this.modelName);else this.model={};if(a){var l=[];if(c){l=this.getAllDuetNodes(c);var m=new ModelProperty(this,c);this.properties.push(m)}else l=this.getAllDuetNodes();l.length>0&&l.forEach(function(a,b){var c=new ModelProperty(g,a);g.properties.push(c)}),this.refreshUI()}for(var n=0;n<this.rosettaComps.length;n++){var o=this.rosettaComps[n];o.lazyInit=!0,o.init(this)}this.rosettaComps=[],this.isInitialization=!1}return Object.defineProperty(a.prototype,"bindings",{get:function(){return window[this.modelName+"_dt-bindings"]},set:function(a){window[this.modelName+"_dt-bindings"]=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"modelName",{get:function(){return this._modelName},set:function(a){this._modelName=a},enumerable:!0,configurable:!0}),a.prototype.refreshUI=function(){this.properties.forEach(function(a){for(var b in a.internalBindings)a.setComponentBinding(a.bindings[b])})},a.prototype.unbind=function(){this.bindings={},this.properties.forEach(function(a){return a.isUnbind=!0}),this._isUnbind=!0,this.subModels.forEach(function(a){return a.unbind()})},a.prototype.getAllDuetNodes=function(a){var b=!1;a?b=void 0!==a.dataset.dtBindingGeneration:a=document;for(var c=a.getElementsByTagName("*"),d=[],e=[],f=0;f<c.length;f++){var g=c[f],h=!1;if(g.attributes.hasOwnProperty("dt")||g.attributes.hasOwnProperty("data-dt")?g.attributes.hasOwnProperty("dt")?l=g.attributes.dt.value==this.originalModel.modelName||b:g.attributes.hasOwnProperty("data-dt")&&(l=g.attributes["data-dt"].value==this.originalModel.modelName||b):l="duet.model"==this.originalModel.modelName||b,l)for(var i=0;i<g.attributes.length&&!h;i++){var j=g.attributes[i],k=j.name,l=!0;if(0==j.name.indexOf("data-")&&(k=j.name.slice(5)),0==k.indexOf("dt")||0==k.indexOf("dt")&&"dt-binding-generation"!=k){for(var m=!1,n=0;n<e.length&&!m;n++)m=e[n].contains(g);m||(d.push(g),(g.hasAttribute("dt-children")||g.hasAttribute("data-dt-children"))&&e.push(g)),h=!0}}}return d},a.prototype.getSimpleModel=function(){return this.toSimpleModel(null,this.model)},a.prototype.getJSON=function(){return JSON.stringify(this.getSimpleModel())},a.prototype.toSimpleModel=function(a,b){if(!a){if("object"!=typeof b)return b;a=b instanceof Array||b instanceof ObservableArray?[]:{}}b||(b=this.model);var c=b["mutated-accesors"];if(c)for(var d in c){var e=c[d];if(0!=e.indexOf("@")&&0!=e.indexOf("#")){var f=b["_"+e],g=f.value;if(g)if("object"==typeof g){var h=[];if(g instanceof Array||g instanceof ObservableArray){for(var i=0;i<g.length;i++){var j=this.toSimpleModel(null,g[i]);h.push(j)}a[e]=h}else g["mutated-accesors"]&&(a[e]={},this.toSimpleModel(a[e],g))}else a[e]=g;else a[e]=null}}else a=b;return a},a.prototype.createObservableObject=function(a,b){if(!("object"!=typeof a||a&&a["mutated-observation"])){var c=this,d="";b&&(d=b);var e=[];for(var f in a)e.push(f);for(var f in e){var g=e[f];if(0!=g.indexOf("_")&&"function"!=typeof a[g]&&"mutated-accesors"!==g&&0!=g.indexOf("$")){var h=d+"|"+g,i=this.bindings[h];"undefined"==typeof i&&(i=new BindableProperty(h,g,a[g],a,this.originalModel.model,null,!0)),ModelProperty.createAccesorProperty(g,a,i),this.createObservableObject(a[g],h),this.bindings[h]=i,document.addEventListener(i.propertyChangeEvent,function(b){return c._isUnbind?void document.removeEventListener(i.propertyChangeEvent,arguments.callee,!1):void(c.isInitialization||(c.checkBindDependencies(b),a._parentReference&&a._parentReference._binding&&a._parentReference._binding.dispatchChangeEvent(b.detail.internalExpression)))},!1)}}null!=a&&(a["mutated-observation"]=!0)}},a.prototype.checkBindDependencies=function(a){var b=a.detail.internalExpression;a.detail._externalReference&&null!=a.detail._externalReference&&(b=a.detail._externalReference);for(var c in this.bindings){var d=this.bindings[c];if((0==d.internalExpression.indexOf("#")||d.isFunction)&&d.internalExpression!==b){var e=d.internalExpression;d.isFunction&&(e=d.funcDefinition),-1!==d.references.indexOf(b)?d.dispatchChangeEvent():this.containsBindReference(e,b)?(d.dispatchChangeEvent(),d.references.push(b)):this.containsBindReference(e,"$"+b)?(d.dispatchChangeEvent(),d.references.push(b)):this.containsBindReference(e,b+"_stringify")&&(d.dispatchChangeEvent(),d.references.push(b))}}},a.isAlphanumeric=function(a,b){var c=a.charCodeAt(b);return c>47&&58>c||c>64&&91>c||c>96&&123>c?!0:!1},a.prototype.containsBindReference=function(b,c){for(var d=!1,e=b.indexOf(c);-1!=e;)"."===b[e-1]&&b.length>=e+c.length&&!a.isAlphanumeric(b,e+c.length)?(d=!0,e=-1):e=b.indexOf(c,e+1);return d},a}(),ModelProperty=function(){function a(b,c){this.modelView=b,this.component=c,this.componentBindings={},this.pendingSync={},this.internalBindings={};var d=!1;if(this.createDatasetAttributes(this.component),this.component&&""==this.component.rosettaID){var e=this.component;!e.lazyInit&&e.init&&this.modelView.rosettaComps.push(e)}for(var f in this.component.dataset){if(this.component.dataset.hasOwnProperty(f)&&0==f.indexOf("dt")&&f.length>2){var g=f[2].toLowerCase()+f.slice(3),h=this.component.dataset[f].trim();g=g.replace("html","HTML"),"bindingGeneration"!==g&&(-1===h.indexOf("#")&&(h=h.replace(".","|")),this.componentBindings[g]=this.modelView.modelName+"|"+h,d=!0)}if("undefined"!=typeof this.component[g]&&null!=this.component[g]&&this.component[g].length>0&&this.component[g][0]instanceof HTMLElement){var i=this.component[g][0];"function"==typeof i?this._template=i.contentDocument.body.children[0]:this._template=i.cloneNode(!0),this.template.removeAttribute("dt"),this.template.removeAttribute("data-dt"),this.createDatasetAttributes(this.template,!0);for(var j=this.modelView.getAllDuetNodes(this._template),k=0;k<j.length;k++)this.createDatasetAttributes(j[k]);i.dataset.dtBindingGeneration=void 0,this.createDatasetAttributes(i),this.component.removeChild(i)}}if(d){this.createPropertyBinding();for(var l in this.componentBindings){var m=this.componentBindings[l],n=this.bindings[m];this.listenChangeEvents(m,n)}var o=this;this.component.addEventListener("componentSync",function(b){if(b instanceof CustomEvent&&b.detail instanceof a){var c=b.detail;c.component;if(c.isUnbind)return void c.component.removeEventListener("componentSync",arguments.callee,!1);var d=o.component;for(var e in c.pendingSync){var f=o.bindings[o.componentBindings[e]],g=e;if(-1!=g.indexOf(".")){var h=g.split(".");g=h[h.length-1],h=h.slice(0,h.length-1),h.forEach(function(a){d[a]||(d[a]={}),d=d[a]})}f.htmlComponent=d,void 0==f||f.ignore||void 0==c.pendingSync[e]||f.value==c.pendingSync[e]||(f.value=c.pendingSync[e])}}},!1)}this.componentSync=new CustomEvent("componentSync",{detail:this})}return Object.defineProperty(a.prototype,"bindings",{get:function(){return this._modelView.bindings},set:function(a){this._modelView.bindings=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"modelView",{get:function(){return this._modelView},set:function(a){this._modelView=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isUnbind",{get:function(){return this._isUnbind},set:function(a){this._observer&&a&&this._observer.disconnect(),this._isUnbind=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"component",{get:function(){return this._component},set:function(b){var c=this,d=this;this._component=b,this._observer=new MutationObserver(function(a){a.forEach(function(a){if("childList"===a.type){var b=c._component.dataset.childrenMap;if(c.modelView.isInitialization)return;if(b&&c._template){var d=c.modelView.model[b],e=new Array;d||(d=[]);for(var f=0;f<a.addedNodes.length;f++)if(a.addedNodes[f]instanceof HTMLElement){var g=a.addedNodes[f];g.dataset.dtBindingGeneration||(c.addChildrenListNode(d,g,c._template),e.push(a.addedNodes[f]))}for(var f=0;f<e.length;f++)null!=e[f].parentNode&&e[f].parentNode.removeChild(e[f]);for(var f=0;f<a.removedNodes.length;f++)if(a.removedNodes[f]instanceof HTMLElement){var g=a.removedNodes[f];g.dataset.dtBindingGeneration&&"undefined"!=g.dataset.dtBindingGeneration&&d.splice(parseInt(g.dataset.dtBindingGeneration),1)}}}else c.syncComponentChange(a.target,a.attributeName)}),c.syncDependencies(d)});var e={attributes:!0,childList:!0,characterData:!0};this._observer.observe(this._component,e),this._component.addEventListener("change",function(){d.isUnbind?d._component.removeEventListener("change",arguments.callee,!1):a.syncComponentEvent(d)},!1),this._component.addEventListener("keydown",function(){d.isUnbind?d._component.removeEventListener("keydown",arguments.callee,!1):a.syncComponentEvent(d)},!1),this._component.addEventListener("keyup",function(){d.isUnbind?d._component.removeEventListener("keyup",arguments.callee,!1):a.syncComponentEvent(d)},!1)},enumerable:!0,configurable:!0}),a.prototype.createDatasetAttributes=function(a,b){for(var c in a.attributes){var d=a.attributes[c];if(null!=d&&d.name)if(0==d.name.indexOf("dt")){b||a.hasAttribute("dt")||a.hasAttribute("data-dt")||"duet.model"==this.modelView.modelName||(a.setAttribute("dt",this.modelView.modelName),a.setAttribute("data-dt",this.modelView.modelName));for(var e=d.name,f=e.indexOf("-");-1!=f;)e=e.replace(/-/,e[f+1].toUpperCase()),e=e.slice(0,f+1)+e.slice(f+2),f=e.indexOf("-");a.dataset[e]=d.value}else"children-map"==d.name&&(a.dataset.childrenMap=d.value,b||a.hasAttribute("dt")||a.hasAttribute("data-dt")||"duet.model"==this.modelView.modelName||(a.setAttribute("dt",this.modelView.modelName),a.setAttribute("data-dt",this.modelView.modelName)))}},a.prototype.listenChangeEvents=function(a,b){function c(a){return d.isUnbind?void document.removeEventListener(b.propertyChangeEvent,arguments.callee,!1):void d.onBindingChange(a)}var d=this;document.removeEventListener(b.propertyChangeEvent,c),document.addEventListener(b.propertyChangeEvent,c,!1);var e=this.component,f=a;if(-1!=f.indexOf(".")){var g=f.split(".");f=g[g.length-1],g=g.slice(0,g.length-1),g.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}this.bindings[a].htmlComponent=e,this.bindings[a].value instanceof ObservableArray&&(document.addEventListener(a+"elementAdded",function(b){if(d.isUnbind)return void document.removeEventListener(a+"elementAdded",arguments.callee,!1);if(b.detail instanceof ObservableItem){var c=d.getComponentBinding(b.detail.name);d.bindingObservableItem(b.detail.name,b.detail.index,b.detail.item,c)}},!1),document.addEventListener(a+"elementRemoved",function(b){if(d.isUnbind)return void document.removeEventListener(a+"elementRemoved",arguments.callee,!1);if(b.detail instanceof ObservableItem){var c=d.getComponentBinding(b.detail.name);null!=c&&(d.component[c][b.detail.index].dataset.dtBindingGeneration=void 0,d.component[c][b.detail.index].remove?d.component[c][b.detail.index].remove():d.component.removeChild(d.component.children[b.detail.index]))}},!1))},a.prototype.syncDependencies=function(a){this.modelView.isInitialization||a.component.dispatchEvent(a.componentSync),a.pendingSync={}},a.prototype.onBindingChange=function(a){a.preventDefault(),this.setComponentBinding(a.detail),this.modelView.isInitialization||this.modelView.checkBindDependencies(a)},a.prototype.bindingObservableItem=function(a,b,c,d){if(this.bindings[a]&&void 0!=this._template){var e=this.modelView.modelName+"|"+a+"|"+b;if(this.modelView.subModels.some(function(a){return a.modelName===e})){var f=null,g=-1;this.modelView.subModels.forEach(function(a){g++,a.modelName==e&&(f=g)}),f>-1&&(this.modelView.subModels[f].bindings={},this.modelView.subModels.splice(f,1))}this._component instanceof HTMLSelectElement&&this._template.dataset&&(this._template.dataset.dtValue||this._template.dataset.dtText)&&(this._template.dataset.dtValue?this.bindings[a].selectValueProp=this._template.dataset.dtValue:this.bindings[a].selectValueProp=this._template.dataset.dtText);var h=this._template.cloneNode(!0);h instanceof HTMLElement&&(h.dataset.dtBindingGeneration=b.toString()),this.component.appendChild(h);var i=new ModelView(e,c,h,d,this.modelView.originalModel,this.modelView);this.modelView.subModels.push(i)}},a.prototype.getComponentBinding=function(a){var b="";for(var c in this.componentBindings)if(a==this.componentBindings[c]){b=c;break}return b},a.prototype.getAllComponentBinding=function(a){var b=[];for(var c in this.componentBindings)a==this.componentBindings[c]&&b.push(c);return b},a.prototype.syncComponentChange=function(a,b){if(a instanceof HTMLElement)for(var c in this.componentBindings){var d=c;if(-1!=c.indexOf(".")&&(d=d.split(".")[0]),d===b){var e=a;if(-1!=c.indexOf(".")){var f=c.split(".");d=f[f.length-1],f=f.slice(0,f.length-1),f.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}this.pendingSync[c]=e[d];break}}},a.prototype.createPropertyBinding=function(){for(var b in this.componentBindings){var c=this.componentBindings[b],d=null;if(this.bindings&&this.bindings[c])d=this.bindings[c],this.internalBindings[c]=d;else{var e=this.modelView.model,f="",g=c;if(-1!==g.indexOf("|")&&(g=g.replace(this.modelView.modelName+"|",""),-1===g.indexOf("#")&&(g=g.replace("|","."))),0!=g.indexOf("#")&&0!=g.indexOf("@")&&-1!=g.indexOf(".")){var h=g.split(".");f=h[h.length-2],g=h[h.length-1],h=h.slice(0,h.length-1),h.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}d=new BindableProperty(c,g,e[g],e,this.modelView.originalModel.model,this.component),a.createAccesorProperty(g,e,d),this.bindings||(this.bindings={}),this.internalBindings[c]=d,this.bindings[c]=d}}},a.prototype.setComponentBinding=function(a){var b=this;a.dirty=!0;for(var c=this.component,d=this.getAllComponentBinding(a.name),e=0;e<d.length;e++){var f=d[e];if(null!=f&&-1!=f.indexOf(".")){var g=f.split(".");f=g[g.length-1],g=g.slice(0,g.length-1),g.forEach(function(a){c[a]||(c[a]={}),c=c[a]})}if(a.htmlComponent=c,"undefined"!=typeof c[f])if(null!=c[f]&&c[f].__proto__==HTMLCollection.prototype){if(a.dirty&&b.template){for(var h=c[f].length-1;h>-1;h--)c[f][h].dataset.dtBindingGeneration=void 0,c[f][h].remove?c[f][h].remove():b.component.removeChild(b.component.children[h]);if(Array.isArray(a.value)||a.value instanceof ObservableArray)for(var i=0;i<a.value.length;i++)b.bindingObservableItem(a.name,i,a.value[i],f);else b.bindingObservableItem(a.name,0,a.value,f)}}else if("undefined"!=typeof a.value)if(c.multiple&&"value"===f)for(var j=c.children.length,i=0;j>i;i++)null!=a.value&&-1!==a.value.indexOf(c.children[i].value)?c.children[i].selected=!0:c.children[i].selected=!1;else c[f]=a.value}},a.prototype.addChildrenListNode=function(a,b,c){var d=this._modelView.getAllDuetNodes(c),e=b.querySelectorAll("*"),f=c.querySelectorAll("*"),g={},h=null;h=this.mapTemplateNode(g,c,b);for(var i=0;i<f.length&&!(e.length<i);i++){var j=f[i];if(-1!==d.indexOf(j)){var k=e[i];if(j instanceof HTMLElement&&k instanceof HTMLElement){var l=j,m=k;h=this.mapTemplateNode(g,l,m)}}}null!=h&&(g=h),a.push(g)},a.prototype.mapTemplateNode=function(a,b,c){for(var d in b.dataset)if(b.dataset.hasOwnProperty(d)&&0==d.indexOf("dt")&&d.length>2){var e=d[2].toLowerCase()+d.slice(3),f=b.dataset[d].trim();if(e=e.replace("html","HTML"),"children"===e&&c[e]){var g=b.dataset.childrenMap;if(!a[g]){a[g]=[];for(var h=0;h<c[e].length;h++){var i=0;b[e].length===c[e].length&&(i=h),this.addChildrenListNode(a[g],c[e][h],b[e][i])}}}else if(-1===f.indexOf("#")&&-1===f.indexOf("@")&&c[e]){if("this"==f)return c[e];a[f]=c[e]}}return null},a.createAccesorProperty=function(a,b,c){if(!(Array.isArray(b)||b instanceof ObservableArray||"object"!=typeof b||b["mutated-accesors"]&&-1!=b["mutated-accesors"].indexOf(a))){var d="_"+a;b[d]=c,Object.defineProperty(b,a,{get:function(){return this[d].value},set:function(a){this[d].value=a},enumerable:!0,configurable:!0}),Object.defineProperty(b,"$"+a,{get:function(){return this[d].objectValue},enumerable:!0,configurable:!0}),Object.defineProperty(b,a+"_stringify",{get:function(){return this[d].stringValue},enumerable:!0,configurable:!0}),b["mutated-accesors"]||(b["mutated-accesors"]=[]),b["mutated-accesors"].push(a)}},a.syncComponentEvent=function(a){for(var b in a.componentBindings)if("undefined"!=typeof a.component[b]&&a.component[b].__proto__!==HTMLCollection.prototype)if(a.component.multiple){for(var c=a.component.children.length,d=[],e=0;c>e;e++)a.component.children[e].selected&&d.push(a.component.children[e].value);a.pendingSync[b]=d}else a.pendingSync[b]=a.component[b];a.syncDependencies(a)},a}(),DynamicCode=function(){function DynamicCode(){}return DynamicCode.evalInContext=function(js,context){return function(){return eval(js)}.call(context)},DynamicCode.parseLambdaExpression=function(a){for(var b=a,c=a.indexOf("=>",c);-1!=c;){for(var d=DynamicCode.getLamdbaStart(a,c),e=a.length-1,f=0,g="",h=c;h<a.length-1;h++){if(")"===a[h]){if(0==f){e=h;break}f--}"("===a[h]&&f++}g=DynamicCode.createLambdaFunction(a.slice(d,e+1)),b=b.slice(0,d+1)+g+b.slice(e),c=b.indexOf("=>")}return b},DynamicCode.createLambdaFunction=function(a){var b="",c=a.indexOf("=>"),d=DynamicCode.getLamdbaStart(a,c),e=a.length-1,f=a.slice(d+1,c),g=a.slice(c+2,e);return-1!=g.indexOf("=>")&&(g=DynamicCode.parseLambdaExpression(g)),b="(function("+f+") { return (",b+=g+");})"},DynamicCode.getLamdbaStart=function(a,b){for(var c=b,d=b;d>-1;d--)if("("===a[d]){c=d;break}return c},DynamicCode}(),BindableProperty=function(){function a(a,b,c,d,e,f,g){if(this.dirty=!1,this._funcExpresion=null,this._funcIsChecked=!1,this.name=a,this._internalExpression=b,this._tempValue=null,this._parentValue=d,this._externalReference=null,this.propertyChange=new CustomEvent(this.propertyChangeEvent,{detail:this}),this.model=e,this.htmlComponent=f,this.references=new Array,this.ignore=!1,this._funcDefinitionString=null,this._lastDispatchTime=null,Array.isArray(c)||c instanceof ObservableArray){if(Array.isArray(c)){var h=null;h=g?new ObservableArray(a,this):new ObservableArray(a),h.initialize(c),this.value=h}else this.value=c;this.dirty=!0}else"this"===b?this.value=d:this.value=c}return Object.defineProperty(a.prototype,"funcDefinition",{get:function(){return null==this._funcDefinitionString&&this._funcDefinition&&(this._funcDefinitionString=this._funcDefinition.toString().replace(" ","")),this._funcDefinitionString},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"internalExpression",{get:function(){return this._internalExpression},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"value",{get:function(){var a=this;this.name;if(0!=this._internalExpression.indexOf("#")&&0!=this._internalExpression.indexOf("@")||"undefined"!=typeof this.dirty&&1!=this.dirty){if("function"==typeof this._value&&null===this._funcExpresion){var b=this._parentValue,c=this.model;this.htmlComponent;this._funcExpresion=this._value.toString(),b["_bind_"+this._internalExpression]=this._value;var d="_bind_"+this._internalExpression;this._value=function(){b.model=c,b.view=this,b[d](),b.model=void 0,b.view=void 0}}else if(this.htmlComponent instanceof HTMLSelectElement&&this.htmlComponent.dataset&&this.htmlComponent.dataset.dtValue&&this.htmlComponent.dataset.dtValue===this.internalExpression&&this.htmlComponent.dataset.dtChildren&&this.dirty){var e=this.htmlComponent.dataset.dtChildren,f=this._parentValue["_"+e].selectValueProp;if("undefined"!=typeof f){var g=this.htmlComponent;if(g.multiple){var h=[];if(null!=this._value){this._value instanceof Array||(this._value=[this._value]);for(var i=this._value.length,j=0;i>j;j++)h.push(this._parentValue[e].find(function(b){return b[f]===a._value[j]}))}this._objectValue=h}else this._objectValue=this._parentValue[e].find(function(b){return b[f]===a._value})}this.dirty=!1}}else{var k=null,l=this._funcExpresion;if(null==l&&(l=this._internalExpression.slice(1),-1!=l.indexOf("=>")&&(l=DynamicCode.parseLambdaExpression(l))),0==this._internalExpression.indexOf("@")){null==this._eventExpresion&&(this._eventExpresion=l);var m=this;k=function(){var a=m._parentValue;a.model=m.model,a.view=m.htmlComponent;var b=DynamicCode.evalInContext(m._eventExpresion,a);return a.model=void 0,a.view=void 0,b}}else{if(this._funcExpresion=l,!this._funcIsChecked&&0==l.indexOf("this.")&&-1!=l.indexOf("(")){var n=l.replace("this.","");n=n.slice(0,n.indexOf("(")),this.isFunction=this._parentValue[n]?"function"==typeof this._parentValue[n]:!1,this.isFunction&&(this._funcDefinition=this._parentValue[n]),this._funcIsChecked=!0}var b=this._parentValue;b.model=this.model,b.view=this.htmlComponent,k=DynamicCode.evalInContext(l,b),b.model=void 0,b.view=void 0}this._value=k,this.dirty=!1}return this._value},set:function(a){this._value=a,this.ignore||this.dispatchChangeEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"objectValue",{get:function(){if(this.dirty){this.value}return this._objectValue},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"stringValue",{get:function(){var a="";return a=null!=this.objectValue||"object"==typeof this.objectValue?JSON.stringify(this.originalObject(this.objectValue)):this.value?this.value.toString():null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"internalValue",{set:function(a){this._value=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"propertyChangeEvent",{get:function(){return"propertyChange"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ignore",{get:function(){return this._ignore},set:function(a){this._ignore&&!a?(this._ignore=a,this.dispatchChangeEvent()):this._ignore=a},enumerable:!0,configurable:!0}),a.prototype.dispatchChangeEvent=function(a){var b=this;return null!==this._lastDispatchTime&&Date.now()-this._lastDispatchTime<50?void(this._pendingEvent||(this._pendingEvent=setTimeout(function(){return b.dispatchChangeEvent(a)},50))):(clearTimeout(this._pendingEvent),this._pendingEvent=void 0,this._lastDispatchTime=Date.now(),void(this.ignore||(a?this._externalReference=a:this._externalReference=null,this.dirty=!0,this.propertyChange=new CustomEvent(this.propertyChangeEvent,{detail:this}),document.dispatchEvent(this.propertyChange))))},a.prototype.subscribe=function(a){var b=this,c=function(){return a(b)};document.addEventListener(this.propertyChangeEvent,c)},a.prototype.originalObject=function(b){var c=null;if(c=Array.isArray(b)||b instanceof ObservableArray?[]:{},b.hasOwnProperty("mutated-accesors")){var d=b["mutated-accesors"];for(var e in d){var f=d[e];if(-1===f.indexOf("#")&&-1===f.indexOf("@")){var g=null;g=b[f]instanceof a?b[f].stringValue:"object"==typeof b[f]?this.originalObject(b[f]):b[f],Array.isArray(c)?c.push(g):c[f]=g}}}else if(Array.isArray(b)||b instanceof ObservableArray)for(var h=0;h<b.length;h++)c.push(this.originalObject(b[h]));else c=b;return c},a}(),duet=function(){function a(){}return Object.defineProperty(a,"fn",{get:function(){return a},enumerable:!0,configurable:!0}),a.bind=function(b,c,d){a.subModels||(a.subModels={}),a.subModelViews||(a.subModelViews={}),c?a.subModels[c]=b:a.model=b,(a.readyComplete||d)&&(c?(a.subModelViews[c]&&(a.subModelViews[c].unbind(),a.subModelViews[c]=void 0),a.subModelViews[c]=new ModelView(c,a.subModels[c])):(a.modelView&&a.modelView.unbind(),a.modelView=new ModelView("duet.model",a.model)))},a.init=function(b){b&&(a.initCallback=b),a.readyBound||(a.readyBound=!0,window.document.addEventListener?window.document.addEventListener("DOMContentLoaded",function(){window.document.removeEventListener("DOMContentLoaded",arguments.callee,!1),a.ready()},!1):window.document.attachEvent&&(window.document.attachEvent("onreadystatechange",function(){"complete"===window.document.readyState&&(window.document.detachEvent("onreadystatechange",arguments.callee),a.ready())}),window.document.documentElement.doScroll&&window==window.top&&function(){if(!a.isReady){try{window.document.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a.ready()}}()),window.onload=a.ready)},a.preInit=function(b){a.preInitCallback=b},a.extend=function(b){for(var c in b)a[c]=b[c]},a.ready=function(){if(!a.isReady){a.preInitCallback&&a.preInitCallback(),a.isReady=!0,a.model&&(a.modelView=new ModelView("duet.model",a.model));for(var b in a.subModels)a.subModelViews[b]=new ModelView(b,a.subModels[b]);a.readyComplete=!0,a.initCallback&&a.initCallback()}},a}();
//# sourceMappingURL=../sourceMap.map
var BindableProperty=function(){function a(a,b,c,d){if(this.dirty=!1,this.name=a,this._tempValue=null,this._parentValue=d,this.hashEventName=b,this.propertyChange=new CustomEvent(this.propertyChangeEvent,{detail:this}),Array.isArray(c)||c instanceof ObservableArray){if(Array.isArray(c)){var e=new ObservableArray(a);e.initialize(c),this.value=e}else this.value=c;this.dirty=!0}else this.value=c}return Object.defineProperty(a.prototype,"value",{get:function(){if(this._parseInProgress)return null;if(0==this.name.indexOf("#")&&1==this.dirty){var a=this.name.slice(1),b=null;if(-1!=a.indexOf("=>")&&(a=DynamicCode.parseLambdaExpression(a)),b=DynamicCode.evalInContext(a,this._parentValue),"object"==typeof b){this._parseInProgress=!0;var c=[];b=JSON.stringify(b,function(a,b){if("object"==typeof b&&null!==b){if(-1!==c.indexOf(b))return;c.push(b)}return b}),c=null,this._parseInProgress=!1,b="#JSON#"+b}return this._value=b,this.dirty=!1,b}return this._value},set:function(a){this._value=a,document.dispatchEvent(this.propertyChange)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"objectValue",{get:function(){if(this.value&&"string"==typeof this.value&&0==this.value.indexOf("#JSON#")){var b=JSON.parse(this.value.slice(6));if(b.hasOwnProperty("mutated-accesors")){var c=b["mutated-accesors"];b["mutated-accesors"]=[];for(var d in c){var e=c[d],f=b["_"+e];ModelProperty.createAccesorProperty(e,b,new a(e,f._hashEventName,f._value,b))}}return b}return this.value},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"internalValue",{set:function(a){this._value=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hashEventName",{get:function(){return this._hashEventName},set:function(a){this._hashEventName=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"propertyChangeEvent",{get:function(){return"propertyChange"+this.hashEventName},enumerable:!0,configurable:!0}),a.prototype.dispatchChangeEvent=function(){this.dirty=!0,document.dispatchEvent(this.propertyChange),this.dirty=!1},a}(),DynamicCode=function(){function DynamicCode(){}return DynamicCode.evalInContext=function(js,context){return function(){return eval(js)}.call(context)},DynamicCode.parseLambdaExpression=function(a){for(var b=a,c=a.indexOf("=>",c);-1!=c;){for(var d=DynamicCode.getLamdbaStart(a,c),e=a.length-1,f=0,g="",h=c;h<a.length-1;h++){if(")"===a[h]){if(0==f){e=h;break}f--}"("===a[h]&&f++}g=DynamicCode.createLambdaFunction(a.slice(d,e+1)),b=b.slice(0,d+1)+g+b.slice(e),c=b.indexOf("=>")}return b},DynamicCode.createLambdaFunction=function(a){var b="",c=a.indexOf("=>"),d=DynamicCode.getLamdbaStart(a,c),e=a.length-1,f=a.slice(d+1,c),g=a.slice(c+2,e);return-1!=g.indexOf("=>")&&(g=DynamicCode.parseLambdaExpression(g)),b="(function("+f+") { return (",b+=g+");})"},DynamicCode.getLamdbaStart=function(a,b){for(var c=b,d=b;d>-1;d--)if("("===a[d]){c=d;break}return c},DynamicCode}(),ModelProperty=function(){function a(b,c){var d=this;this.modelView=b,this.component=c,this.componentBindings={},this.pendingSync={};var e=!1;for(var f in this.component.dataset){if(this.component.dataset.hasOwnProperty(f)&&0==f.indexOf("dt")&&f.length>2){var g=f[2].toLowerCase()+f.slice(3),h=this.component.dataset[f];g=g.replace("html","HTML"),this.componentBindings[g]=h,e=!0}if(void 0!=this.component[g]&&this.component[g].length>0&&this.component[g][0]instanceof HTMLElement){var i=this.component[g][0];this._template=i,this.component.removeChild(i)}}if(e){this.createPropertyBinding();for(var j in this.componentBindings){var k=this.componentBindings[j],l=this.bindings[k];document.addEventListener(l.propertyChangeEvent,function(a){return d.onBindingChange(a)},!1),this.bindings[k].objectValue instanceof ObservableArray&&(document.addEventListener(k+"elementAdded",function(a){if(a.detail instanceof ObservableItem){var b=d.getComponentBinding(a.detail.name);d.bindingObservableItem(a.detail.name,a.detail.index,a.detail.item,b)}}),document.addEventListener(k+"elementRemoved",function(a){if(a.detail instanceof ObservableItem){var b=d.getComponentBinding(a.detail.name);null!=b&&(d.component[b][a.detail.index].remove?d.component[b][a.detail.index].remove():d.component.removeChild(d.component.children[a.detail.index]))}}))}this.component.addEventListener("componentSync",function(b){if(b instanceof CustomEvent&&b.detail instanceof a){var c=b.detail;c.component;for(var e in c.pendingSync){var f=d.bindings[d.componentBindings[e]],g=d.component;if(-1!=e.indexOf(".")){var h=e.split(".");e=h[h.length-1],h=h.slice(0,h.length-1),h.forEach(function(a){g[a]||(g[a]={}),g=g[a]})}void 0!=f&&void 0!=g[e]&&f.value!=g[e]&&(f.value=g[e])}}},!1)}this.componentSync=new CustomEvent("componentSync",{detail:this})}return Object.defineProperty(a.prototype,"bindings",{get:function(){return this._modelView.bindings},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"modelView",{get:function(){return this._modelView},set:function(a){this._modelView=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"component",{get:function(){return this._component},set:function(a){var b=this,c=this;this._component=a;var d=new MutationObserver(function(a){a.forEach(function(a){return b.syncComponentChange(a.target,a.attributeName)}),b.syncDependencies(c)}),e={attributes:!0,childList:!1,characterData:!0};d.observe(this._component,e),this._component.onchange=function(){void 0!=typeof c.component.value&&(b.pendingSync.value=c.component.value),b.syncDependencies(c)},this._component.onkeyup=function(){void 0!=typeof c.component.value&&(b.pendingSync.value=c.component.value),b.syncDependencies(c)}},enumerable:!0,configurable:!0}),a.prototype.syncDependencies=function(a){this.modelView.isInitialization||a.component.dispatchEvent(a.componentSync),a.pendingSync={}},a.prototype.onBindingChange=function(a){a.preventDefault();var b=this.component,c=this.getComponentBinding(a.detail.name);if(null!=c&&-1!=c.indexOf(".")){var d=c.split(".");c=d[d.length-1],d=d.slice(0,d.length-1),d.forEach(function(a){b[a]||(b[a]={}),b=b[a]})}if(void 0!=typeof b[c])if(b[c].__proto__==HTMLCollection.prototype){if(this.bindings[a.detail.name].dirty){for(var e=b[c].length-1;e>-1;e--)b[c][e].remove?b[c][e].remove():this.component.removeChild(this.component.children[e]);if(Array.isArray(a.detail.objectValue)||a.detail.objectValue instanceof ObservableArray)for(var f=0;f<a.detail.objectValue.length;f++)this.bindingObservableItem(a.detail.name,f,a.detail.objectValue[f],c);else this.bindingObservableItem(a.detail.name,0,a.detail.objectValue,c)}}else b[c]=a.detail.value;if(!this.modelView.isInitialization)for(var g in this.bindings)0==g.indexOf("#")&&-1!=g.indexOf(a.detail.name)&&g!==a.detail.name&&this.bindings[g].dispatchChangeEvent()},a.prototype.bindingObservableItem=function(a,b,c,d){if(this.bindings[a]&&void 0!=this._template){var e=this._template.cloneNode(!0);this.component.appendChild(e);var f=new ModelView(a+"_"+b,c,e,d);this.modelView.subModels.push(f)}},a.prototype.getComponentBinding=function(a){var b="";for(var c in this.componentBindings)if(a==this.componentBindings[c]){b=c;break}return b},a.prototype.syncComponentChange=function(a,b){if(a instanceof HTMLElement)for(var c in this.componentBindings){var d=c;if(-1!=c.indexOf(".")&&(d=d.split(".")[0]),d===b){var e=a;if(-1!=c.indexOf(".")){var f=c.split(".");d=f[f.length-1],f=f.slice(0,f.length-1),f.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}this.pendingSync[c]=e[d];break}}},a.prototype.createPropertyBinding=function(){for(var b in this.componentBindings){var c=this.componentBindings[b],d=null;if(this.bindings&&this.bindings[c])d=this.bindings[c];else{var e=this.modelView.model,f="",g=c;if(0!=c.indexOf("#")&&-1!=c.indexOf(".")){var h=c.split(".");f=h[h.length-2],g=h[h.length-1],h=h.slice(0,h.length-1),h.forEach(function(a){e[a]||(e[a]={}),e=e[a]})}d=new BindableProperty(c,this.modelView.modelName+"_"+f+"_"+c,e[g],e),a.createAccesorProperty(g,e,d),this.bindings||(this.bindings={}),this.bindings[c]=d}}},a.createAccesorProperty=function(a,b,c){if(!b["mutated-accesors"]||-1==b["mutated-accesors"].indexOf(a)){var d="_"+a;b[d]=c,Object.defineProperty(b,a,{get:function(){return this[d].value},set:function(a){this[d].value=a},enumerable:!0,configurable:!0}),Object.defineProperty(b,"$"+a,{get:function(){return this[d].objectValue},enumerable:!0,configurable:!0}),b["mutated-accesors"]||(b["mutated-accesors"]=[]),b["mutated-accesors"].push(a)}},a}();!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=Event.prototype,window.CustomEvent=a}();var ModelView=function(){function a(a,b,c,d){var e=this;if(this.modelName=a,this.properties=new Array,this.bindings={},this.subModels=new Array,this.isInitialization=!0,b&&(this.model=b),a){var f=null;if(c){f=c.querySelectorAll("[data-dt='"+d+"']");var g=new ModelProperty(this,c);for(var h in g.bindings)g.bindings[h].dispatchChangeEvent();this.properties.push(g)}else f=document.querySelectorAll("[data-dt='"+a+"']");if(f.length>0){var i=Array.prototype.slice.call(f,0);i.forEach(function(a,b){if(a instanceof HTMLElement){var c=new ModelProperty(e,a);e.properties.push(c)}});for(var h in this.bindings)this.bindings[h].dispatchChangeEvent()}}this.isInitialization=!1}return Object.defineProperty(a.prototype,"modelName",{get:function(){return this._modelName},set:function(a){this._modelName=a},enumerable:!0,configurable:!0}),a}(),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},ObservableArray=function(a){function b(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];a.call(this),this._name=b}return __extends(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),b.prototype.initialize=function(b){var c=this;b.forEach(function(b){return a.prototype.push.call(c,b)})},b.prototype.push=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];var e=0;return c.forEach(function(c){e=a.prototype.push.call(b,c),b.elementAdded=new CustomEvent(b.name+"elementAdded",{detail:new ObservableItem(b.name,c,e)}),document.dispatchEvent(b.elementAdded)}),e},b.prototype.pop=function(){var b=this.length-1,c=a.prototype.pop.call(this);return this.elementRemoved=new CustomEvent(this.name+"elementRemoved",{detail:new ObservableItem(this.name,c,b)}),document.dispatchEvent(this.elementRemoved),c},b.prototype.unshift=function(){for(var b=this,c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];var e=0;return c.forEach(function(c){e=a.prototype.unshift.call(b,c),b.elementAdded=new CustomEvent(b.name+"elementAdded",{detail:new ObservableItem(b.name,c,e)}),document.dispatchEvent(b.elementAdded)}),e},b.prototype.shift=function(){var b=a.prototype.shift.call(this);return this.elementRemoved=new CustomEvent(this.name+"elementRemoved",{detail:new ObservableItem(this.name,b,0)}),document.dispatchEvent(this.elementRemoved),b},b.prototype.change=function(a,b){var c=this[a];for(var d in c)b[d]&&(c[d]=b[d])},b}(Array),ObservableItem=function(){function a(a,b,c){this.name=a,this.item=b,this.index=c}return a}();
//# sourceMappingURL=../sourceMap.map
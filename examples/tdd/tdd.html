<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TDD Example</title>
<script src="../../build/duet.js"></script>
<script type="text/javascript">
	var tdd = null;

	window.onload = (function(){
		var selTask = function(){
					tdd.model.task = this.description;
					tdd.model.selectedTask = this;
					tdd.model.isSelectTask = true;
				};

		var model = {
			task: null,
			selectedTask: null,
			isSelectTask: false,
			showArchiveTasks: true,
			tasks: [],		
			cleanTask: (function(){
				tdd.model.task = "";
				tdd.model.selectedTask = null;
				tdd.model.isSelectTask = false;
			}),
			updateTasks: (function () {
				if(tdd.model.isSelectTask)
					tdd.model.selectedTask.description = tdd.model.task;
				else
					tdd.model.tasks.push({ done: false, description: tdd.model.task, selectTask: selTask });

				tdd.model.cleanTask();
			}),
			countTasks: (function (isDone, checkArchive){
				var force = false;

				if(checkArchive)
					force = this.showArchiveTasks;

				if(force)
					return this.tasks.filter(function(n){ return n.done === isDone || force}).length;
				else
					return this.tasks.filter(function(n){ return n.done === isDone}).length;
			})
		};

		tdd = new ModelView("tdd", model);
	});
	
</script>
</head>

<body>
	<div>
		<p>Task description:</p>
		<input type="text" data-dt="tdd" data-dt-value="task" />
		<input type="button" data-dt="tdd" data-dt-value="#this.isSelectTask? 'Update': 'Add'" 
			data-dt-disabled="#!this.task || this.task.length == 0" data-dt-onclick="updateTasks" />
		<input type="button" value="clean" data-dt="tdd" data-dt-onclick="cleanTask" />
		<p>
			<input id="chkArchive" type="checkbox" data-dt="tdd" data-dt-checked="showArchiveTasks" />
			<label for="chkArchive">Show archived (<span data-dt="tdd" data-dt-innerHTML="#this.countTasks(true, false)"></span>)</label>
		</p>
		<p>Tasks (<span data-dt="tdd" data-dt-innerHTML="#this.countTasks(false, true)"></span>)</p>
		<ul data-dt="tdd" data-dt-children="#var force = this.showArchiveTasks; this.tasks.filter(n => !n.done || force)">
			<il>
				<input type="checkbox" data-dt="children" data-dt-checked="done" />				
				<span data-dt="children" data-dt-innerHTML="description" data-dt-style.text-decoration="#this.done? 'line-through': ''"
					 data-dt-onclick="@this.selectTask()"  onmouseover="" style="cursor: pointer;"></span>
				<br />
			</il>
		</ul>
	</div>
</body>

</html> 